<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mini COD-Style Shooter</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #050814;
      color: #f7f7f7;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      justify-content: flex-start;
    }

    h1 {
      margin-top: 16px;
      margin-bottom: 4px;
      font-size: 24px;
    }

    #subtitle {
      font-size: 13px;
      color: #c4c4c4;
      margin-bottom: 12px;
      text-align: center;
    }

    #gameContainer {
      margin-top: 10px;
      padding: 12px;
      border-radius: 12px;
      background: #0b1020;
      box-shadow: 0 10px 26px rgba(0, 0, 0, 0.7);
      display: inline-block;
    }

    canvas {
      background: radial-gradient(circle at center, #101629 0, #050814 60%);
      border-radius: 8px;
      display: block;
    }

    #hud {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 10px;
      font-size: 14px;
      gap: 10px;
    }

    #scores {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .badge {
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 13px;
      background: #151c32;
    }

    .score {
      color: #4ade80;
    }

    .highscore {
      color: #38bdf8;
    }

    #message {
      min-height: 18px;
      font-size: 13px;
      color: #facc15;
      text-align: center;
      flex: 1;
    }

    button {
      border: none;
      background: #ef4444;
      color: white;
      font-size: 13px;
      padding: 6px 14px;
      border-radius: 999px;
      cursor: pointer;
      transition: transform 0.1s ease, box-shadow 0.1s ease, background 0.2s ease;
      white-space: nowrap;
    }

    button:hover {
      background: #dc2626;
      box-shadow: 0 0 12px rgba(239, 68, 68, 0.6);
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
      box-shadow: none;
    }

    #controls {
      text-align: center;
      margin-top: 10px;
      font-size: 12px;
      color: #d1d5db;
      max-width: 600px;
    }
  </style>
</head>
<body>
  <h1>Mini COD-Style Arena</h1>
  <div id="subtitle">
    Move with <strong>WASD / Arrow keys</strong>, aim with your mouse, and <strong>click</strong> to shoot.
  </div>

  <div id="gameContainer">
    <canvas id="game" width="800" height="450"></canvas>
    <div id="hud">
      <div id="scores">
        <div class="badge score">Score: <span id="scoreSpan">0</span></div>
        <div class="badge highscore">Best: <span id="highScoreSpan">0</span></div>
      </div>
      <div id="message"></div>
      <button id="restartBtn">Restart</button>
    </div>
  </div>

  <div id="controls">
    Survive as long as you can. Each enemy you eliminate gives +1 score. If an enemy touches you, youâ€™re down.<br />
    Tip: keep moving and watch the edges of the map for incoming enemies.
  </div>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");

    const scoreSpan = document.getElementById("scoreSpan");
    const highScoreSpan = document.getElementById("highScoreSpan");
    const messageEl = document.getElementById("message");
    const restartBtn = document.getElementById("restartBtn");

    const WIDTH = canvas.width;
    const HEIGHT = canvas.height;

    // Player settings
    const player = {
      x: WIDTH / 2,
      y: HEIGHT / 2,
      radius: 14,
      speed: 260,
      alive: true,
    };

    // Game arrays
    let bullets = [];
    let enemies = [];

    // Game state
    let keys = {};
    let mousePos = { x: WIDTH / 2, y: HEIGHT / 2 };
    let isMouseDown = false;
    let lastShotTime = 0;
    const fireCooldown = 0.2; // seconds

    let score = 0;
    let highScore = 0;
    let lastSpawnTime = 0;
    let spawnInterval = 1.2; // seconds
    let gameOver = false;

    // Time tracking
    let lastTimestamp = 0;

    // Input handling
    window.addEventListener("keydown", (e) => {
      keys[e.key.toLowerCase()] = true;
      if (["arrowup", "arrowdown", "arrowleft", "arrowright", " "].includes(e.key.toLowerCase())) {
        e.preventDefault();
      }
    });

    window.addEventListener("keyup", (e) => {
      keys[e.key.toLowerCase()] = false;
    });

    canvas.addEventListener("mousemove", (e) => {
      const rect = canvas.getBoundingClientRect();
      mousePos.x = e.clientX - rect.left;
      mousePos.y = e.clientY - rect.top;
    });

    canvas.addEventListener("mousedown", () => {
      isMouseDown = true;
    });

    window.addEventListener("mouseup", () => {
      isMouseDown = false;
    });

    restartBtn.addEventListener("click", resetGame);

    function resetGame() {
      score = 0;
      bullets = [];
      enemies = [];
      player.x = WIDTH / 2;
      player.y = HEIGHT / 2;
      player.alive = true;
      gameOver = false;
      spawnInterval = 1.2;
      lastShotTime = 0;
      lastSpawnTime = 0;
      updateScoreUI();
      messageEl.textContent = "Good luck, soldier.";
      lastTimestamp = performance.now();
      requestAnimationFrame(loop);
    }

    function updateScoreUI() {
      scoreSpan.textContent = score;
      highScoreSpan.textContent = highScore;
    }

    function spawnEnemy() {
      // Spawn at a random edge
      const edge = Math.floor(Math.random() * 4); // 0:top,1:right,2:bottom,3:left
      let x, y;
      const margin = 10;
      if (edge === 0) { // top
        x = Math.random() * WIDTH;
        y = -margin;
      } else if (edge === 1) { // right
        x = WIDTH + margin;
        y = Math.random() * HEIGHT;
      } else if (edge === 2) { // bottom
        x = Math.random() * WIDTH;
        y = HEIGHT + margin;
      } else { // left
        x = -margin;
        y = Math.random() * HEIGHT;
      }

      const speed = 60 + Math.random() * 50;
      const radius = 12;
      enemies.push({ x, y, radius, speed });
    }

    function shootBullet(time) {
      if (time - lastShotTime < fireCooldown) return;
      lastShotTime = time;

      // Direction from player to mouse
      const dx = mousePos.x - player.x;
      const dy = mousePos.y - player.y;
      const len = Math.sqrt(dx * dx + dy * dy) || 1;
      const vx = (dx / len) * 480;
      const vy = (dy / len) * 480;

      bullets.push({
        x: player.x,
        y: player.y,
        vx,
        vy,
        radius: 4,
        life: 1.0, // seconds
      });
    }

    function update(dt, time) {
      if (gameOver) return;

      // Player movement
      let moveX = 0;
      let moveY = 0;
      if (keys["w"] || keys["arrowup"]) moveY -= 1;
      if (keys["s"] || keys["arrowdown"]) moveY += 1;
      if (keys["a"] || keys["arrowleft"]) moveX -= 1;
      if (keys["d"] || keys["arrowright"]) moveX += 1;

      let length = Math.hypot(moveX, moveY);
      if (length > 0) {
        moveX /= length;
        moveY /= length;
      }

      player.x += moveX * player.speed * dt;
      player.y += moveY * player.speed * dt;

      // Clamp to arena
      player.x = Math.max(player.radius, Math.min(WIDTH - player.radius, player.x));
      player.y = Math.max(player.radius, Math.min(HEIGHT - player.radius, player.y));

      // Shooting
      if (isMouseDown) {
        shootBullet(time / 1000);
      }

      // Update bullets
      for (let i = bullets.length - 1; i >= 0; i--) {
        const b = bullets[i];
        b.x += b.vx * dt;
        b.y += b.vy * dt;
        b.life -= dt;
        if (
          b.life <= 0 ||
          b.x < -20 ||
          b.x > WIDTH + 20 ||
          b.y < -20 ||
          b.y > HEIGHT + 20
        ) {
          bullets.splice(i, 1);
        }
      }

      // Spawn enemies over time (slightly faster over time)
      lastSpawnTime += dt;
      if (lastSpawnTime >= spawnInterval) {
        spawnEnemy();
        lastSpawnTime = 0;
        spawnInterval = Math.max(0.4, spawnInterval * 0.98); // ramp difficulty
      }

      // Update enemies (move towards player)
      for (let i = enemies.length - 1; i >= 0; i--) {
        const e = enemies[i];
        const dx = player.x - e.x;
        const dy = player.y - e.y;
        const lenE = Math.sqrt(dx * dx + dy * dy) || 1;
        const vx = (dx / lenE) * e.speed;
        const vy = (dy / lenE) * e.speed;
        e.x += vx * dt;
        e.y += vy * dt;

        // Check collision with player
        const distToPlayer = Math.hypot(e.x - player.x, e.y - player.y);
        if (distToPlayer < e.radius + player.radius) {
          // Player is hit
          player.alive = false;
          gameOver = true;
          if (score > highScore) highScore = score;
          updateScoreUI();
          messageEl.textContent = "Mission failed. Press Restart to try again.";
          return;
        }
      }

      // Bullet-enemy collisions
      for (let i = enemies.length - 1; i >= 0; i--) {
        const e = enemies[i];
        for (let j = bullets.length - 1; j >= 0; j--) {
          const b = bullets[j];
          const d = Math.hypot(b.x - e.x, b.y - e.y);
          if (d < e.radius + b.radius) {
            enemies.splice(i, 1);
            bullets.splice(j, 1);
            score += 1;
            if (score > highScore) highScore = highScore; // updated at end
            updateScoreUI();
            break;
          }
        }
      }

      if (score > highScore) {
        highScore = score;
        updateScoreUI();
      }
    }

    function draw() {
      ctx.clearRect(0, 0, WIDTH, HEIGHT);

      // Optional faint grid
      ctx.save();
      ctx.globalAlpha = 0.05;
      ctx.beginPath();
      for (let x = 0; x <= WIDTH; x += 40) {
        ctx.moveTo(x, 0);
        ctx.lineTo(x, HEIGHT);
      }
      for (let y = 0; y <= HEIGHT; y += 40) {
        ctx.moveTo(0, y);
        ctx.lineTo(WIDTH, y);
      }
      ctx.strokeStyle = "#ffffff";
      ctx.stroke();
      ctx.restore();

      // Draw player (soldier)
      if (player.alive) {
        // Body
        ctx.fillStyle = "#22c55e";
        ctx.beginPath();
        ctx.arc(player.x, player.y, player.radius, 0, Math.PI * 2);
        ctx.fill();

        // Direction line (gun) towards mouse
        ctx.strokeStyle = "#bbf7d0";
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.moveTo(player.x, player.y);
        const dx = mousePos.x - player.x;
        const dy = mousePos.y - player.y;
        const len = Math.sqrt(dx * dx + dy * dy) || 1;
        const gunLength = 24;
        ctx.lineTo(
          player.x + (dx / len) * gunLength,
          player.y + (dy / len) * gunLength
        );
        ctx.stroke();
      }

      // Draw enemies
      for (const e of enemies) {
        ctx.fillStyle = "#ef4444";
        ctx.beginPath();
        ctx.arc(e.x, e.y, e.radius, 0, Math.PI * 2);
        ctx.fill();

        ctx.fillStyle = "#fee2e2";
        ctx.font = "8px system-ui";
        ctx.textAlign = "center";
        ctx.fillText("ENEMY", e.x, e.y - e.radius - 4);
      }

      // Draw bullets
      ctx.fillStyle = "#e5e7eb";
      for (const b of bullets) {
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.radius, 0, Math.PI * 2);
        ctx.fill();
      }

      // Crosshair
      ctx.save();
      ctx.strokeStyle = "#facc15";
      ctx.lineWidth = 1;
      ctx.beginPath();
      ctx.arc(mousePos.x, mousePos.y, 8, 0, Math.PI * 2);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(mousePos.x - 12, mousePos.y);
      ctx.lineTo(mousePos.x + 12, mousePos.y);
      ctx.moveTo(mousePos.x, mousePos.y - 12);
      ctx.lineTo(mousePos.x, mousePos.y + 12);
      ctx.stroke();
      ctx.restore();
    }

    function loop(timestamp) {
      if (!lastTimestamp) lastTimestamp = timestamp;
      const dt = (timestamp - lastTimestamp) / 1000;
      lastTimestamp = timestamp;

      update(dt, timestamp);
      draw();

      if (!gameOver) {
        requestAnimationFrame(loop);
      }
    }

    // Start the first game
    resetGame();
  </script>
</body>
</html>
